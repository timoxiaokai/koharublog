---
import { siteConfig } from '@constants/site-config';
import { getLqipStyle } from '@lib/lqip';
import { Icon } from 'astro-icon/components';
import { formatInTimeZone } from 'date-fns-tz';
import readingTime from 'reading-time';
import type { BlogPost } from 'types/blog';
import { MAX_WIDTH } from '@/constants/layout';
import WaveSvg from './wave';

export interface CoverProps {
  data?: BlogPost;
  title?: string;
}

const { data, title } = Astro.props as CoverProps;

const { date, updated, title: dataTitle, draft } = data?.data ?? {};

const readState = readingTime(data?.body ?? '');
const isDraft = import.meta.env.DEV && draft === true;

// 获取横幅图片的 LQIP 样式
const bannerLqipStyle = getLqipStyle('/img/site_header_1920.webp');
---

<div class="relative flex h-[60dvh] max-h-200 overflow-hidden">
  <div class="absolute inset-0 h-full bg-black/40"></div>
  <div class="absolute inset-0 bottom-[8dvh] flex flex-col items-center justify-center px-5 text-white">
    {
      title ? (
        <h1
          class={`shadow-text word-break flex items-center gap-2 text-center text-5xl/[1.2] font-bold tracking-widest ${MAX_WIDTH.content}`}
        >
          {title}
          <Icon
            name="ri:link"
            title="复制链接"
            class="hover:text-primary cursor-pointer transition-colors duration-300"
            onclick="navigator.clipboard.writeText(window.location.href)"
          />
        </h1>
      ) : data ? (
        <>
          <h1
            class={`shadow-text word-break text-4.5xl text-center font-bold md:text-2xl ${MAX_WIDTH.content} flex flex-wrap items-center justify-center gap-3`}
          >
            {dataTitle ?? title}
            {isDraft && (
              <span class="inline-flex items-center gap-1.5 rounded-full bg-yellow-500 px-3 py-1.5 text-base font-semibold text-white shadow-lg backdrop-blur-sm text-shadow-none hover:bg-yellow-500 md:px-2.5 md:py-1 md:text-sm">
                <Icon name="fa6-solid:file-pen" class="h-4 w-4 md:h-3.5 md:w-3.5" />
                草稿
              </span>
            )}
          </h1>
          {data && (
            <p class="mt-3 flex flex-wrap items-center justify-center gap-4 md:text-xs">
              <span class="flex items-center gap-1">
                <Icon name="fa6-solid:calendar-days" />
                发表于 {date && formatInTimeZone(date, 'UTC', 'yyyy-MM-dd HH:mm')}
              </span>
              {updated && (
                <span class="flex items-center gap-1">
                  <Icon name="fa6-solid:calendar-days" />
                  更新于 {formatInTimeZone(updated, 'UTC', 'yyyy-MM-dd HH:mm')}
                </span>
              )}
              <span class="flex items-center gap-1">
                <Icon name="fa6-solid:pen-nib" /> {readState?.words} 字
              </span>
              <span class="flex items-center gap-1">
                <Icon name="fa6-solid:clock" />
                {readState?.text}
              </span>
            </p>
          )}
        </>
      ) : (
        <>
          <h2 class="shadow-text font-chill-round text-5xl/[1.2]">{siteConfig?.alternate}</h2>
          <h1 class="shadow-text font-chill-round mt-3 text-5xl/[1.2] font-bold tracking-widest">{siteConfig?.title}</h1>
          <p class="shadow-text mt-5 text-sm">= {siteConfig?.subtitle} =</p>
        </>
      )
    }
  </div>
  <div
    class="relative -z-10 h-full min-h-60 w-full"
    transition:persist="page-cover-banner"
    id="banner-box"
    style={bannerLqipStyle}
  >
    <!--此处更换banner背景-->
    <img
      src="/img/p-hutao.jpg"
      alt="cover"
      class="0 60"
      sizes="50vw"
      srcset="/img/m-HutaoXFucaros.png 800w,/img/p-hutao.jpg 1200w"
      loading="eager"
      fetchpriority="high"
      decoding="async"
    />
  </div>
  <WaveSvg />
</div>
